# Hooks
åœ¨ Hooks å‡ºç°ä¹‹å‰ï¼Œç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶çš„åˆ†å·¥ä¸€èˆ¬æ˜¯è¿™æ ·çš„ï¼š

- **ç±»ç»„ä»¶**æä¾›äº†å®Œæ•´çš„çŠ¶æ€ç®¡ç†å’Œç”Ÿå‘½å‘¨æœŸæ§åˆ¶ï¼Œé€šå¸¸ç”¨æ¥æ‰¿æ¥å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¢«ç§°ä¸ºâ€œèªæ˜ç»„ä»¶â€
- **å‡½æ•°ç»„**ä»¶åˆ™æ˜¯çº¯ç²¹çš„ä»æ•°æ®åˆ°è§†å›¾çš„æ˜ å°„ï¼Œå¯¹çŠ¶æ€æ¯«æ— æ„ŸçŸ¥ï¼Œå› æ­¤é€šå¸¸è¢«ç§°ä¸ºâ€œå‚»ç“œç»„ä»¶â€

é‚£ä¹ˆ Hooks çš„å‡ºç°åˆæ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ

- å‡½æ•°ç»„ä»¶ä¸­ä¸èƒ½æ‹¥æœ‰è‡ªå·±çš„çŠ¶æ€ï¼ˆstateï¼‰ã€‚åœ¨ hooks ä¹‹å‰å‡½æ•°ç»„ä»¶æ˜¯æ— çŠ¶æ€çš„ï¼Œéƒ½æ˜¯é€šè¿‡ props æ¥è·å–çˆ¶ç»„ä»¶çš„çŠ¶æ€ï¼Œä½†æ˜¯ hooks æä¾›äº†`useState`æ¥ç»´æŠ¤å‡½æ•°ç»„ä»¶å†…éƒ¨çš„çŠ¶æ€ã€‚
- é€»è¾‘å†…èšï¼Œä¾‹å¦‚ setInterval å’Œ clearInterval è¿™ç§å…·æœ‰å¼ºå…³è”çš„é€»è¾‘è¢«æ‹†åˆ†åœ¨ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­ã€‚å‡½æ•°ç»„ä»¶ä¸­ä¸èƒ½ç›‘å¬ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚`useEffect`èšåˆäº†å¤šä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°
- ç»„ä»¶å¤ç”¨ï¼ˆæ•°æ®å…±äº«æˆ–åŠŸèƒ½å¤ç”¨ï¼‰çš„å›°å±€ï¼Œä»æ—©æœŸçš„ Mixinï¼Œåˆ°[é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰](https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.reactjs.org%2Fdocs%2Fhigher-order-components.html)ï¼Œå†åˆ° Render Props(ä¸€ä¸ªç”¨äºå‘ŠçŸ¥ç»„ä»¶éœ€è¦æ¸²æŸ“ä»€ä¹ˆå†…å®¹çš„å‡½æ•° prop)ï¼Œå§‹ç»ˆæ²¡æœ‰ä¸€ä¸ªæ¸…æ™°ç›´è§‚åˆä¾¿äºç»´æŠ¤çš„ç»„ä»¶å¤ç”¨æ–¹æ¡ˆ

#### useState

çŠ¶æ€çš„å£°æ˜å’Œæ”¹å˜ï¼Œæ¯ä¸€æ¬¡çš„æ¸²æŸ“éƒ½æ˜¯ç‹¬ç«‹çš„éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ props å’Œ stateï¼Œå¤šä¸ª setState ä¼šåˆå¹¶åˆ°ä¸€èµ·æ‰§è¡Œå†å»æ›´æ–° domã€‚

```javascript
function Counter() {
  const [count, setCount] = useState(0);

  function handleAlertClick() {
    setTimeout(() => {
      alert("You clicked on: " + count);
    }, 3000);
  }

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
      <button onClick={handleAlertClick}>Show alert</button>
    </div>
  );
}
```

#### useEffect

`useEffect`æ¥æ”¶ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªä¾èµ–é¡¹ï¼Œç±»ä¼¼äº class ç»„ä»¶ didMountã€didUpdateã€willUnmount çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ä¼šå†æ¬¡æ‰§è¡Œï¼ˆç©ºæ•°ç»„åˆ™åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚

- æ¯ä¸ª Effect å¿…ç„¶åœ¨æ¸²æŸ“ä¹‹åæ‰§è¡Œï¼Œå› æ­¤ä¸ä¼šé˜»å¡æ¸²æŸ“ï¼Œæé«˜äº†æ€§èƒ½ï¼ˆå¦‚æœæƒ³åœ¨æ¸²æŸ“å‰æ‰§è¡Œï¼Œä½¿ç”¨`useLayoutEffect`ï¼‰
- åœ¨è¿è¡Œæ¯ä¸ª Effect ä¹‹å‰ï¼Œè¿è¡Œå‰ä¸€æ¬¡æ¸²æŸ“çš„ Effect Cleanup å‡½æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼Œå³ return çš„å‡½æ•°ï¼‰
- å½“ç»„ä»¶é”€æ¯æ—¶ï¼Œè¿è¡Œæœ€åä¸€æ¬¡ Effect Cleanup å‡½æ•°
- ä¸è¦åœ¨å¾ªç¯ã€åµŒå¥—ã€æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨ Hookâ€”â€”å› ä¸ºè¿™äº›åŠ¨æ€çš„è¯­å¥å¾ˆæœ‰å¯èƒ½ä¼šå¯¼è‡´æ¯æ¬¡æ‰§è¡Œç»„ä»¶å‡½æ•°æ—¶è°ƒç”¨ Hook çš„é¡ºåºä¸èƒ½å®Œå…¨ä¸€è‡´ï¼Œå¯¼è‡´ Hook é“¾è¡¨è®°å½•çš„æ•°æ®å¤±æ•ˆ

```javascript
useEffect(() => {
  const intervalId = setInterval(doSomething(), 1000);
  return () => clearInterval(intervalId);
}, []);
```

#### useEffectLayout

å¯¹äº React çš„å‡½æ•°ç»„ä»¶æ¥è¯´ï¼Œå…¶æ›´æ–°è¿‡ç¨‹å¤§è‡´åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š

1. å› ä¸ºæŸä¸ªäº‹ä»¶ state å‘ç”Ÿå˜åŒ–ã€‚
2. React å†…éƒ¨æ›´æ–° state å˜é‡ã€‚
3. React å¤„ç†æ›´æ–°ç»„ä»¶ä¸­ return å‡ºæ¥çš„ DOM èŠ‚ç‚¹ï¼ˆè¿›è¡Œä¸€ç³»åˆ— dom diff ã€è°ƒåº¦ç­‰æµç¨‹ï¼‰ã€‚
4. å°†æ›´æ–°è¿‡åçš„ DOM æ•°æ®ç»˜åˆ¶åˆ°æµè§ˆå™¨ä¸­ã€‚
5. ç”¨æˆ·çœ‹åˆ°æ–°çš„é¡µé¢ã€‚

`useEffect` åœ¨ç¬¬ 4 æ­¥ä¹‹åæ‰§è¡Œï¼Œä¸”æ˜¯å¼‚æ­¥çš„ï¼Œä¿è¯äº†ä¸ä¼šé˜»å¡æµè§ˆå™¨è¿›ç¨‹ã€‚ `useLayoutEffect` åœ¨ç¬¬ 3 æ­¥è‡³ç¬¬ 4 æ­¥ä¹‹é—´æ‰§è¡Œï¼Œä¸”æ˜¯åŒæ­¥ä»£ç ï¼Œæ‰€ä»¥ä¼šé˜»å¡åé¢ä»£ç çš„æ‰§è¡Œã€‚

#### useRef

`useRef`ç”¨äºè·å–åŸç”Ÿ DOM æˆ–è€…ç»„ä»¶å®ä¾‹ï¼Œæˆ–è€…ä¿å­˜ä¸€äº›çŠ¶æ€ç­‰ã€‚å®ƒå°†ä¸€ä¸ªå‚æ•°æˆ–å‚æ•°ä½œä¸ºå…¶åˆå§‹å€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¼•ç”¨æˆ–æŒä¹…åŒ–çš„å¯å˜å€¼

```javascript
import React, { useState, useEffect, useRef } from "react";

export default function Demo() {
  const [like, setLike] = useState(0);
  const likeRef = useRef(0);
  const domRef = useRef(null);

  useEffect(() => {});

  const handleClick = () => {
    setLike(like + 1);
    likeRef.current = likeRef.current + 1;
    domRef.current.focus();
  };

  const getLikeValue = () => {
    setTimeout(() => {
      alert(likeRef.current);
    }, 2000);
  };

  return (
    <div>
      <button onClick={handleClick}>+</button>
      <button>{like} ğŸ‘</button>
      <button onClick={getLikeValue}>è·å¾—likeå€¼</button>
      <input ref={domRef} type="text" />
    </div>
  );
}
```

#### useImperativeHandle

`useImperativeHandle(ref, createHandle, [deps])`æ–¹ä¾¿åœ¨ä½¿ç”¨ ref æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ï¼Œæ¯”å¦‚çˆ¶ç»„ä»¶è·å–å­ç»„ä»¶ä¸­çš„å€¼ã€è°ƒç”¨å­ç»„ä»¶ä¸­çš„æ–¹æ³•ã€‚

```javascript
// çˆ¶ç»„ä»¶
import React, { useRef } from 'react'
import ForwardButton from './ForwardButton'

export default () => {
    const parentRef = useRef(null)
    const handleClick = () => {
      console.log(parentRef.current.getContent()) // æŒ‰é’®1
    }
    return (
    	<div className="wrapper">
        <ForwardButton ref={parentRef}>æŒ‰é’®1</ForwardButton>
        <button onClick={handleClick}>è·å–button1</button>
      </div>
    )
}

// å­ç»„ä»¶
import React, { useImperativeHandle, forwardRef } from 'react'
const RefInFunctionalComponent = (props, ref) => {
  const innerRef = useRef(null)
  useImperativeHandle(ref, () => ({
    getContent: () => innerRef.current.innerText
  }))
  const handleClick1 = () => {
    console.log(ref.current.innerText)
  }
  return <button ref={innerRef} onClick={handleClick1}>{props.children}</button>
}
const ForwardButton = forwardRef(RefInFunctionalComponent)
export default ForwardButton;

```

#### useMemo

å¯ä»¥ç¼“å­˜å€¼ï¼Œæ˜¯`useCallback`çš„è¶…é›†ï¼Œæ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°ä»¥åŠä¾èµ–é¡¹ï¼Œåªæœ‰ä¾èµ–é¡¹å˜åŒ–æ—¶æ‰ä¼šé‡æ–°æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚

#### useCallback

ç¼“å­˜æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°ä»¥åŠä¾èµ–é¡¹ï¼Œå¹¶ä¸”è¿”å›è¯¥å›è°ƒå‡½æ•°çš„ memorize ç‰ˆæœ¬ï¼Œåªæœ‰åœ¨ä¾èµ–é¡¹é‡æ–°å˜åŒ–æ—¶æ‰ä¼šé‡æ–°è¿”å›æ–°çš„ memorize ç‰ˆæœ¬ã€‚å…¶å®å°±æ˜¯é¿å…æ¯æ¬¡é‡æ–°æ¸²æŸ“åéƒ½å»é‡æ–°æ‰§è¡Œä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚

- é€šè¿‡ç¼“å­˜è®¡ç®—ç»“æœï¼ŒèŠ‚çœè´¹æ—¶çš„è®¡ç®—
- ä¿è¯ç›¸åŒè¾“å…¥ä¸‹è¿”å›å€¼çš„å¼•ç”¨ç›¸ç­‰

æœ‰å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ `useEffect` ä¸­ä½¿ç”¨æŸä¸ªå®šä¹‰çš„å¤–éƒ¨å‡½æ•°ï¼Œæ˜¯è¦æ·»åŠ åˆ° deps æ•°ç»„ä¸­çš„ï¼Œå¦‚æœä¸ç”¨ `useCallback` ç¼“å­˜ï¼Œè¿™ä¸ªå‡½æ•°åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶éƒ½æ˜¯ä¸€ä¸ªå®Œå…¨æ–°çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¼•ç”¨åœ°å€å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™å°±ä¼šå¯¼è‡´ `useEffect` æ€»ä¼šæ— æ„ä¹‰çš„æ‰§è¡Œã€‚

å¼•ç”¨  
[ç”¨åŠ¨ç”»å’Œå®æˆ˜æ‰“å¼€ React Hooksï¼ˆä¸€ï¼‰ï¼šuseState å’Œ useEffect](https://juejin.cn/post/6844904127110053895)  
[ã€ŒReact è¿›é˜¶ã€ React å…¨éƒ¨ Hooks ä½¿ç”¨å¤§å…¨ ï¼ˆåŒ…å« React v18 ç‰ˆæœ¬ ï¼‰](https://juejin.cn/post/7118937685653192735)

<br>
  
> è¯­é›€åœ°å€ https://www.yuque.com/cheeseyu/fullstack/eutkus